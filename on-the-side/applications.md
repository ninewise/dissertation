## Case studies and analyses {#section:casestudies}

During development, the still incomplete pipeline was applied to several
datasets as a means of exploration. This has helped to find bugs,
usability problems, discover other applications and guide the UMGAP to
its final form. This section describes the analysis of these datasets,
as it would be done using the released version of the UMGAP, not as it
was executed originally. As such, this section may be used as a guide to
compose a new pipeline for a similar analysis.

The \ref{section:preconf} stuff.

* Annelies Haegeman https://biblio.ugent.be/person/F7927142-F0ED-11E1-A9DE-61C894A0A6B4

### The preconfigured pipelines {#section:preconf}

The primary and easiest procedure to run the UMGAP on your data, and the
last addition to the pipeline, is by using one of the six preconfigured
pipelines. They are six diverging ways of configuring the pipeline,
picked to cover the most probable use cases. Should your data fall within
such a use case, running the pipeline is reduced to running two or three
scripts.

The first is a setup script called `umgap-setup.sh`. It is an
interactive script which helps you get the required databases and
optional external tools in the right place. In general, the setup script
only needs to run once, but it can also be used to verify the file
locations and download newer versions of the data.

Following code snippet shows the interaction with the setup script.
It starts out by asking the relevant questions, without delay. At the
end, it downloads the relevant files in sequence, without further
interaction. In this snippet, we choose to download the taxonomy and the
tryptic index, as this example will use a tryptic pipeline.

```shell
$ umgap-setup.sh -f /opt/FragGeneScanPlusPlus
Use '/home/user/.config/unipept' as configuration directory? [y]/n y
Created directory /home/user/.config/unipept.
Found, tested and remembered the FragGeneScan++ location.
Use '/home/user/.local/share/unipept' as data directory? [y]/n y
Created directory /home/user/.local/share/unipept.
Checking the latest version on the server.
Latest version is 2020-12-02.

For any type of analysis, you need a taxonomony. For mapping tryptic or
9-mer peptides to it, you need the respective index file of the same
version.

Would you like to download the taxonomy from 2020-12-02 (115MiB)? [y]/n y
Would you like to download the tryptic index from 2020-12-02 (12GiB)? [y]/n y
Would you like to download the 9-mer index from 2020-12-02 (152GiB)? [y]/n n
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  114M  100  114M    0     0  6477k      0  0:00:18  0:00:18 --:--:-- 6332k
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   12G  100   12G    0     0  5076k      0  0:34:12  0:34:12 --:--:-- 5790k
```

The script also allows further configuration via some flags.

`-c dir`
  ~ Set a different configuration directory.

`-f dir`
  ~ Link the location of your FragGeneScan installation.

`-d dir`
  ~ Set a different location for downloading the database files. This
    can be on a separate disk.

`-y`
  ~ Download all files of the latest version without asking for
    confirmation.

This last flag, `-y`, is especially useful when running the setup script
from another script, e.g. an automatic update script.

The second script is the main analysis script, aptly called
`umgap-analyse.sh`. It will run a selected pipeline on the input data
using the databases downloaded by the setup script. Consider for
instance a 100 paired-end reads sampled from a dataset generated by
@lindgreen for their MetaBenchmark. With these paired-end reads in the
`A1.fq` and `A2.fq` files, the commands are as follows.

```shell
$ head -4 A1.fq
@1198114###CP002480-_Acidobacteria_733918/1
ATCGCGCACGCGGCCGATGCCCCAGAAGAGATTGACAGCGGTGGGGCGGGCGGCGGCGAGGTGGTCGCAGATCTCGGCGACCTCTGCGTTGAGGGTCGGG
+
AADEGGAGIIEIHFHKHJKKJKHIJJIIKCJAHBFKKFHIJIF;JIH5DE$I>CBE$E:FGEJCGABEEECCDKD?D?C$ECEEE;CEEDEEAD=?ED$D
$ umgap-analyse.sh -1 A1.fq -2 A2.fq -t tryptic-precision -z -o tryptic-precision-output.fa.gz
$ zcat tryptic-precision-output.fa.gz | head -2
>1198114###CP002480-_Acidobacteria_733918/1_1_100_-
1
```

It seems the pipeline cannot be more specific than root (Taxon ID 1) for
the first read.

The analysis script was passed a single series of arguments here (`-1`
to through `-o`), but it accepts multiple such sequences (along with the
other flags specified below) to combine multiple analyses into a single
command.

`-c dir`
  ~ Set a different configuration directory.

`-1 file`
  ~ Single ended FASTA or first pair-ended FASTQ input file, optionally
    compressed.

`-2 file`
  ~ Second pair-ended FASTQ input file, optionally compressed.

`-t`
  ~ Type of the analysis. This flag allows you to select one of the preconfigured pipelines.

    - `high-precision` is the default pipeline and is optimized for high
      precision identifications on your metagenomics reads.

    - `max-precision` is optimized for highest precision, with a small
      setback on sensitivity.

    - `tryptic-precision` is made for fast analyses on your laptop.
      Fewer results, but accurate.

    - `high-sensitivity` is optimized for high sensitivity
      identifications on metagenomics reads.

    - `max-sensitivity` is optimized for highest sensitivity, with a
      small setback on precision.

    - `tryptic-sensitivity` is made for fast analyses on your laptop.
      Get a quick overview of your data.

`-z`
  ~ Request compression of the output file.

`-o file`
  ~ The output file.

The output file contains a single taxonomic prediction for every read
after the analysis script. To interpret these results without parsing
and scripting visualizations, the `umgap-visualize.sh` script is
provided. This visualization script can create importable CSV frequency
tables and interactive visualizations. The latter can be stored locally
or hosted online. The following snippet creates all three in turn.

```shell
$ umgap-visualize.sh -t -r phylum tryptic-precision-output.fa.gz
taxon id,taxon name,tryptic-precision-output.fa.gz
1117,Cyanobacteria,2
57723,Acidobacteria,4
201174,Actinobacteria,4
1224,Proteobacteria,5
1,root,160
$ umgap-visualize.sh -w tryptic-sensitivity-output.fa.gz > tryptic-sensitivity.html
$ umgap-visualize.sh -u tryptic-sensitivity-output.fa.gz
tryptic-sensitivity-output.fa.gz: https://bl.ocks.org/11b7809d6754b9530cf1a49d93a8d568
```

The CSV tables contain a record for each taxon found in the sample.
A record contains, in order, the taxon ID, (for convenience) the
taxon name and the number of reads assigned to this taxon or below.
All records will be at the same specified taxon rank or at root
(unidentified).

`-t`
  ~ Output a CSV frequency table on species rank.
`-w`
  ~ Output an HTML web page of an interactive visualization.
`-u`
  ~ Print a shareable URL to a online interactive visualization.
`-r rank`
  ~ Set the rank for the CSV frequency table (default: species).

### A home brew taxonomic analysis pipeline {#section:homebrew}

### A comparative analysis {#section:comparative}

Peat substrate amended with chitin modulates the N-cycle, siderophore and chitinase responses in the lettuce rhizobiome

### A transcriptomics analysis pipeline {#section:transcript}

Steve Baeyen https://biblio.ugent.be/publication?q=author%3D%22Baeyen%2C+Steve%22

### Finding viral traces {#section:viral}

Sebastiaan Theuns https://biblio.ugent.be/person/0767592A-F0EE-11E1-A9DE-61C894A0A6B4
